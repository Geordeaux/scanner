# schema: https://scanner.dev/schema/scanner-detection-rule.v1.json
name: Cloudflare WAF Allowed Threat
description: |-
  ## Goal
  Detect when Cloudflare's Web Application Firewall (WAF) detects
  a threat but takes an "Allow" action instead of blocking it,
  which may indicate a misconfiguration or bypass attempt.

  ## Strategy
  Monitor Cloudflare logs for this specific threat type. Correlate with origin server logs.

  ## Triage and Response
  1. Validate the finding in the Cloudflare dashboard.
  2. Identify the source IP and user agent.
  3. Check if the request was blocked or allowed.
  4. If allowed and malicious, update WAF rules to block.
enabled: true
severity: High
query_text: |-
  %ingest.source_type:cloudflare
  (WAFRuleID:* or WAFRuleMessage:*)
  WAFAction:Allow
  | groupbycount(ClientIP)
  | where @q.count > 0
time_range_s: 300
run_frequency_s: 60
event_sink_keys:
- high_severity_alerts
tags:
- tactics.ta0001.initial_access
- techniques.t1190.exploit_public_facing_application
- techniques.t1133.external_remote_services
- source.cloudflare
