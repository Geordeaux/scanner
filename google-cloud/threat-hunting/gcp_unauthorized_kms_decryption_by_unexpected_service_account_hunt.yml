# schema: https://scanner.dev/schema/scanner-threat-hunting-query.v1.json
name: Unauthorized KMS Decryption by Unexpected Service Account
description: |-
  Detect when a Key Management Service (KMS) decryption operation is carried out by a service account that is not in the allowlist. This may indicate unauthorized access.
query_text: |-
  %ingest.source_type:gcp_audit_log
  metadata.log_type:GCP_CLOUDAUDIT
  metadata.product_event_type:"Decrypt"
  target.application:"cloudkms.googleapis.com"
  not principal.user.email_addresses:(
    allowed-sa-1@project.iam.gserviceaccount.com
    allowed-sa-2@project.iam.gserviceaccount.com
  )
tags:
- gcp_audit_log
- kms
- unauthorized_kms_decryption
- techniques.t1078.valid_accounts
- tactics.ta0006.credential_access
