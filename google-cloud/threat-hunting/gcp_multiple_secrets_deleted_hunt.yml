# schema: https://scanner.dev/schema/scanner-threat-hunting-query.v1.json
name: GCP Multiple Secrets Deleted
description: |-
  Detect when multiple secrets or secret versions are deleted from GCP Secret Manager. This behavior may indicate an attempt to compromise data integrity or availability, which could be malicious.
query_text: |-
  %ingest.source_type:gcp
  protoPayload.serviceName:secretmanager.googleapis.com
  protoPayload.methodName:(google.cloud.secretmanager.v1.SecretManagerService.DestroySecretVersion google.cloud.secretmanager.v1.SecretManagerService.DeleteSecret)
  | groupbycount(project_id, protoPayload.authenticationInfo.principalEmail)
  | where @q.count >= 10
tags:
- source.gcp
- gcp
- gcp_secrets
- gcp_audit
- multiple_secrets_deleted
- techniques.t1485.data_destruction
- tactics.ta0040.impact
