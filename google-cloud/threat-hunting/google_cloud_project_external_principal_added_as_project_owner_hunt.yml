# schema: https://scanner.dev/schema/scanner-threat-hunting-query.v1.json
name: Google Cloud Project external principal added as project owner
description: |-
  Detect attempts to add an external principal as a project owner in Google Cloud.
query_text: |-
  %ingest.source_type:gcp
  protoPayload.serviceName:cloudresourcemanager.googleapis.com
  protoPayload.methodName:InsertProjectOwnershipInvite
  data.protoPayload.request.member:(*gmail.com *googlemail.com)
  | groupbycount(project_id, protoPayload.authenticationInfo.principalEmail)
  | where @q.count > 0
tags:
- source.gcp
- techniques.t1098.account_manipulation
- tactics.ta0003.persistence
