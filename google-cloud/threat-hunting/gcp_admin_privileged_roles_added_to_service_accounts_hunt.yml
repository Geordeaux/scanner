# schema: https://scanner.dev/schema/scanner-threat-hunting-query.v1.json
name: GCP Admin Privileged Roles Added To Service Accounts
description: |-
  Detect when admin privileged roles such as Owner or Editor are added to a Service Account. This could indicate an attempt to escalate privileges, which is a common tactic used by adversaries for persistence and privilege escalation.
query_text: |-
  %ingest.source_type:gcp_audit
  metadata.event_type:USER_RESOURCE_UPDATE_PERMISSIONS
  metadata.log_type:GCP_CLOUDAUDIT
  metadata.product_event_type:SetIamPolicy
  security_result.action:ALLOW
  target.resource.attribute.labels.ser_binding_deltas_action:ADD
  (
    target.resource.attribute.labels.ser_binding_deltas_role:"roles/owner" or
    target.resource.attribute.labels.ser_binding_deltas_role:"roles/editor"
  )
  target.resource.attribute.labels.ser_binding_deltas_member:serviceAccount
tags:
- source.gcp
- gcp_audit
- role_assignment
- techniques.t1098.account_manipulation
- tactics.ta0003.persistence
- tactics.ta0004.privilege_escalation
