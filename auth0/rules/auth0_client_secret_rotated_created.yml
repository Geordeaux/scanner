# schema: https://scanner.dev/schema/scanner-detection-rule.v1.json
name: Auth0 Client Secret Rotated or Created
description: |-
  ## Goal
  Detects when a client secret is rotated or created in Auth0. Attackers may
  rotate secrets to maintain persistence or gain unauthorized access to
  applications.

  ## Strategy
  1. Determine if this was part of a scheduled secret rotation policy.
  2. Contact the application owner to verify.
  3. Check if the user has permissions to manage secrets for this client.

  ## Triage and Response
  1. Identify the user (`data.user_id`) and the client (application) involved.
  2. Check the timestamp and source IP.
  1. If unauthorized, rotate the secret again immediately to invalidate the attacker's key.
  2. Investigate the user account for compromise.
  3. Monitor the application for suspicious usage with the new secret.
enabled: true
severity: Medium
query_text: |-
  %ingest.source_type:auth0
  data.type:sapi
  (
  (data.description:"Rotate a client secret") or
  (data.description:"Create a client secret")
  )
  data.details.request.path:/api/v2/clients/*/rotate-secret
  | groupbycount(data.user_id)
  | where @q.count > 0
time_range_s: 300
run_frequency_s: 60
event_sink_keys:
- medium_severity_alerts
tags:
- tactics.ta0003.persistence
- techniques.t1098.account_manipulation
- source.auth0
