# schema: https://scanner.dev/schema/scanner-threat-hunting-query.v1.json
name: 'TTB Hunt: GCP TTB High Diversity Anomaly'
description: |-
  Hunt for users with high diversity in GCP Services and Method Names.
query_text: |-
  %ingest.source_type="google_cloud_audit"
  | stats
    distinct_count(protoPayload.serviceName) as terrain_score,
    distinct_count(protoPayload.methodName) as behavior_score
    by protoPayload.authenticationInfo.principalEmail
  | sort -terrain_score, -behavior_score
tags:
- source.gcp
- ttb.anomaly
- defense_evasion
