# schema: https://scanner.dev/schema/scanner-detection-rule.v1.json
name: AWS GuardDuty Black Hole Traffic Detected
enabled: true
severity: High
description: |-
  ## Goal
  Detects when an Amazon EC2 instance or a container attempts to communicate with a black hole IP address. This could indicate exfiltration of data or communication with malicious actors.

  ## Strategy
  Monitor GuardDuty findings for the detection of black hole traffic (finding types containing `BlackholeTraffic`). Capture relevant details such as the principal IP, user, and location to assess potential threats.

  ## Triage and response
  Investigate the detected black hole traffic event to determine if it was authorized. Review the user agent, principal IPs, and other details to assess potential threats. Ensure that no unauthorized communication is occurring.
query_text: |-
  %ingest.source_type="aws:guardduty"
  metadata.vendor_name:AMAZON
  metadata.product_name:"AWS GuardDuty"
  metadata.product_event_type:*BlackholeTraffic*
  not security_result.about.labels.Sample:"true"
  | groupbycount(
  recipientAccountId,
  principal.ip,
  target.resource.product_object_id
  )
  | where @q.count > 0
time_range_s: 3600
run_frequency_s: 300
event_sink_keys:
- high_severity_alerts
tags:
- source.aws
- domain.cloud
- domain.guardduty
- tactics.ta0011.command_and_control
- techniques.t1071.application_layer_protocol
- use_case.aws_guardduty
- use_case.network_blackhole_traffic
context_fields:
- recipientAccountId
- awsRegion
- principal.ip
- principal.ip_geo_artifact.location.country_or_region
- principal.ip_geo_artifact.location.state
- principal.user.user_display_name
- target.resource.name
- target.resource.product_object_id
- security_result.summary
- security_result.description
- security_result.severity
- security_result.severity_details
- metadata.product_event_type
