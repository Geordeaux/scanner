# schema: https://scanner.dev/schema/scanner-detection-rule.v1.json
name: AWS KMS Key Disabled Or Scheduled For Deletion
enabled: true
severity: High
description: |-
  ## Goal
  Detects when an AWS KMS key is disabled or scheduled for deletion. This can indicate an attempt to disrupt data availability or destroy sensitive information.

  ## Strategy
  Monitor AWS CloudTrail management events where:
  * The service is KMS (`kms.amazonaws.com`), and
  * The action is one of:
    * `DisableKey`
    * `ScheduleKeyDeletion`

  These actions may represent:
  * Legitimate key lifecycle operations as part of an approved change, or
  * Malicious or unsafe attempts to render encrypted data inaccessible or to destroy key material.

  ## Triage and Response
  * Validate:
    * Whether the key operation aligns with an approved change request or key rotation plan.
    * The initiating principal (userIdentity.arn, type, and assumed role), and whether they are authorised to manage KMS keys.
    * The business criticality of the key (for example, production data, backups, secrets encryption).
  * If suspicious or unapproved:
    * Immediately engage the relevant service owners and security.
    * Assess impact: which services, data stores, or backups rely on the key.
    * Where possible, cancel scheduled deletion and restore key state according to your key management procedures.
  * Longer term:
    * Review KMS key policies and IAM permissions for over-privileged principals.
    * Ensure key management operations are tightly controlled and monitored.
query_text: |-
  %ingest.source_type="aws:cloudtrail"
  eventSource:"kms.amazonaws.com"
  eventName:(
  "DisableKey"
  "ScheduleKeyDeletion"
  )
time_range_s: 3600
run_frequency_s: 3600
event_sink_keys:
- high_severity_alerts
tags:
- source.aws
- domain.cloud
- domain.kms
- domain.key_management
- tactics.ta0040.impact
- techniques.t1485.data_destruction
- use_case.kms_key_lifecycle
- use_case.data_destruction
context_fields:
- userIdentity.type
- userIdentity.arn
- userIdentity.userName
- sourceIPAddress
- userAgent
- awsRegion
- eventTime
- eventID
- recipientAccountId
- requestParameters.keyId
- requestParameters.pendingWindowInDays
- responseElements
