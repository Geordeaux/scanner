# schema: https://scanner.dev/schema/scanner-detection-rule.v1.json
name: AWS GuardDuty Publishing Destination Deleted
enabled: true
severity: High
description: |-
  ## Goal
  Detects when an Amazon GuardDuty detector's publishing destination is deleted. This prevents exporting of GuardDuty findings and may indicate an attempt to impair defences by disabling downstream monitoring, alerting, or archival.

  ## Strategy
  Monitor AWS CloudTrail management events from `guardduty.amazonaws.com` and alert on:
  * `DeletePublishingDestination` events for any GuardDuty detector.

  These actions should be rare, tightly controlled, and usually associated with planned changes to central logging or SIEM integrations. Any unplanned change warrants immediate investigation.

  ## Triage and Response
  * Identify who initiated the change (IAM user or role), from where (IP, user agent), and in which account and region.
  * Confirm there is an approved change, maintenance window, or documented migration that explains deletion of the publishing destination.
  * If there is no valid justification:
    * Treat as a high-severity incident (potential defence evasion / logging impairment).
    * Confirm whether GuardDuty findings are still being exported elsewhere (S3, EventBridge, SIEM).
    * Recreate or restore the publishing destination as appropriate.
    * Review recent CloudTrail activity for the same principal and account (especially GuardDuty, CloudTrail, Config, IAM, logging, and network controls).
    * Escalate according to the incident response process.
query_text: |-
  %ingest.source_type="aws:cloudtrail"
  eventSource:"guardduty.amazonaws.com"
  eventName:"DeletePublishingDestination"
  | where errorCode IS NULL
time_range_s: 3600
run_frequency_s: 3600
event_sink_keys:
- high_severity_alerts
tags:
- source.aws
- domain.cloud
- domain.guardduty
- domain.logging_and_monitoring
- tactics.ta0005.defence_evasion
- techniques.t1562.impair_defences
- techniques.t1562.008.disable_cloud_logging_monitoring
- use_case.control_plane_hardening
- use_case.guardduty_integrations
context_fields:
- userIdentity.type
- userIdentity.arn
- userIdentity.userName
- sourceIPAddress
- userAgent
- awsRegion
- requestParameters
- responseElements
- recipientAccountId
- eventID
- eventTime
- requestParameters.detectorId
- requestParameters.destinationId
