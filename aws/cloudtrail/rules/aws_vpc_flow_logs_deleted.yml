# schema: https://scanner.dev/schema/scanner-detection-rule.v1.json
name: AWS VPC Flow Logs Deleted
enabled: true
severity: Low
description: |-
  ## Goal
  Detect deletion of AWS VPC Flow Logs. This may indicate an attempt to tamper with or disable network logging and monitoring, impairing defensive mechanisms and post-incident investigation.

  ## Strategy
  Monitor AWS CloudTrail management events from `ec2.amazonaws.com` with:
  * `eventName="DeleteFlowLogs"`

  Focus on successful deletions of flow logs associated with production VPCs, internet-facing workloads, or security monitoring.

  ## Triage and Response
  * Identify which VPCs, subnets, or network interfaces were covered by the deleted flow logs.
  * Confirm whether the deletion aligns with an approved change request or maintenance activity.
  * Review recent activity from the same principal and source IP for related attempts to weaken logging (e.g. CloudTrail, CloudWatch Logs, Config).
  * If unapproved, treat as a high-priority event: preserve evidence, assess the impact on network visibility, and reinstate required VPC Flow Logs.
query_text: |-
  %ingest.source_type="aws:cloudtrail"
  eventSource="ec2.amazonaws.com"
  eventName="DeleteFlowLogs"
  | groupbycount(
  recipientAccountId,
  awsRegion,
  userIdentity.type,
  userIdentity.arn,
  requestParameters.flowLogIds,
  sourceIPAddress
  )
  | where @q.count > 0
time_range_s: 3600
run_frequency_s: 300
event_sink_keys:
- low_severity_alerts
tags:
- source.aws
- domain.cloud
- domain.network
- domain.logging
- tactics.ta0005.defence_evasion
- techniques.t1562.008.impair_defences_disable_cloud_logs
- use_case.aws_logging
- use_case.vpc_flow_logs
context_fields:
- recipientAccountId
- awsRegion
- eventTime
- eventSource
- eventName
- requestParameters.flowLogIds
- userIdentity.type
- userIdentity.arn
- userIdentity.accountId
- userIdentity.userName
- userIdentity.sessionContext.sessionIssuer.arn
- sourceIPAddress
- userAgent
- errorCode
- errorMessage
