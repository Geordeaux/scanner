# schema: https://scanner.dev/schema/scanner-detection-rule.v1.json
name: AWS MultiFactor Authentication Disabled
enabled: true
severity: Medium
description: |-
  ## Goal
  Detects attempts to disable multi-factor authentication (MFA) for an AWS IAM user, which could indicate an unauthorized attempt to bypass MFA.

  ## Strategy
  Monitor AWS CloudTrail events for actions that disable MFA, such as `DeleteVirtualMFADevice` and `DeactivateMFADevice`. If these actions are detected within a one-hour window, trigger an alert.

  ## Triage and Response
  Investigate further to confirm whether the actions were authorized by checking with relevant stakeholders. Verify that no unauthorized changes have been made to IAM user settings. Consider reviewing access controls and logging to ensure no unauthorized modifications have occurred.
query_text: |-
  %ingest.source_type="aws:cloudtrail"
  metadata.vendor_name:AMAZON
  metadata.product_name:"AWS CloudTrail"
  (
  metadata.product_event_type:DeleteVirtualMFADevice or
  metadata.product_event_type:DeactivateMFADevice
  )
  security_result.action:ALLOW
  | groupbycount(
  additional.fields.recipientAccountId,
  principal.user.user_display_name
  )
  | where @q.count > 0
time_range_s: 3600
run_frequency_s: 3600
event_sink_keys:
- medium_severity_alerts
tags:
- source.aws
- domain.cloud
- domain.iam
- credential_access
- defense_evasion
- persistence
- modify_authentication_process
- multi_factor_authentication
- techniques.t1556.modify_authentication_process
- tactics.ta0006.credential_access
- tactics.ta0005.defense_evasion
- tactics.ta0003.persistence
