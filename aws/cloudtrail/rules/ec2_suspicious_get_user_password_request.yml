# schema: https://scanner.dev/schema/scanner-detection-rule.v1.json
name: EC2 Suspicious Get User Password Request
description: |-
  ## Goal
  Identifies when a user makes `GetPasswordData` requests for multiple different EC2 instances.
  This API call retrieves the encrypted administrator password for an instance running Windows. Multiple requests may indicate an adversary attempting to escalate privileges or move laterally.

  ## Strategy
  Identifies when a user makes `GetPasswordData` requests for multiple different EC2 instances.
  This API call retrieves the encrypted administrator password for an instance running Windows. Multiple requests may indicate an adversary attempting to escalate privileges or move laterally.

  ## Triage and Response
  Investigate and remediate as appropriate.
enabled: true
severity: High
query_text: |-
  %ingest.source_type:aws:cloudtrail
  eventName:GetPasswordData
  eventSource:"ec2.amazonaws.com"
  | parse_json requestParameters "instanceId"
  | stats count_distinct(instanceId) as instance_count by userIdentity.arn
  | where instance_count >= 2
time_range_s: 3600
run_frequency_s: 60
event_sink_keys:
- high_severity_alerts
tags:
- tactics.ta0006.credential_access
- techniques.t1552.005.cloud_instance_metadata_api
- source.aws.cloudtrail
