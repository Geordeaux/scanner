# schema: https://scanner.dev/schema/scanner-detection-rule.v1.json
name: AWS Lambda Update Function Code
enabled: true
severity: Low
description: |-
  ## Goal
  Detects when an IAM user attempts to update or modify AWS Lambda function code. This can indicate an attempt to execute malicious code in the serverless environment.

  ## Strategy
  Monitor AWS CloudTrail management events where:
  * The service is Lambda (`lambda.amazonaws.com`), and
  * The action is `UpdateFunctionCode`.

  These events may represent:
  * Legitimate deployments or code updates as part of CI/CD.
  * Manual or ad-hoc updates that bypass normal deployment pipelines.
  * Malicious attempts to inject or modify serverless code.

  ## Triage and Response
  * Validate:
    * The initiating principal (userIdentity.arn, type, and name) and whether they are authorised to modify Lambda functions.
    * Whether the change aligns with an approved deployment or change request.
    * Which function(s) were updated and their criticality (production vs non-production).
  * If suspicious or unapproved:
    * Coordinate with application owners to confirm the expected code state.
    * Review recent function invocations and logs for signs of malicious behaviour.
    * Consider rolling back to a known-good version or redeploying from source control.
  * Longer term:
    * Enforce Lambda updates via CI/CD only and restrict direct console/API code updates.
    * Tighten IAM policies for Lambda code modification and add mandatory review for production functions.
query_text: |-
  %ingest.source_type="aws:cloudtrail"
  eventSource:"lambda.amazonaws.com"
  eventName:"UpdateFunctionCode"
  userIdentity.type:"IAMUser"
time_range_s: 3600
run_frequency_s: 3600
event_sink_keys:
- low_severity_alerts
tags:
- source.aws
- domain.cloud
- domain.lambda
- domain.serverless
- tactics.ta0002.execution
- techniques.t1648.serverless_execution
- use_case.lambda_code_change
- use_case.serverless_execution
context_fields:
- userIdentity.type
- userIdentity.arn
- userIdentity.userName
- sourceIPAddress
- userAgent
- awsRegion
- eventTime
- eventID
- recipientAccountId
- requestParameters.functionName
- requestParameters.revisionId
- requestParameters.publish
- responseElements
