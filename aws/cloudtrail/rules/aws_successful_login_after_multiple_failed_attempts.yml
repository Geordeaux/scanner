# schema: https://scanner.dev/schema/scanner-detection-rule.v1.json
name: AWS Successful Login After Multiple Failed Attempts
enabled: true
severity: Medium
description: |-
  ## Goal
  Detect multiple failed AWS console authentication attempts (for example, four or more) for the same user within a short window. This pattern often precedes a successful login and can indicate brute force activity or account compromise.

  ## Strategy
  Monitor AWS CloudTrail sign-in events from `signin.amazonaws.com` with `eventName=ConsoleLogin` where the login result is a failure. Aggregate these events over a 15-minute window and flag users with four or more failed attempts.

  ## Triage and Response
  * Confirm whether the failed attempts originated from expected locations, IP addresses, and devices for the user.
  * Check whether there was a subsequent successful login by the same user around the same time.
  * If suspicious, force a password reset, revoke sessions/keys as appropriate, and review other activity for the user in the same time window.
  * Consider tightening authentication controls (MFA, conditional access, IP allow-listing) for sensitive accounts.
query_text: |-
  %ingest.source_type="aws:cloudtrail"
  eventSource:"signin.amazonaws.com"
  eventName:ConsoleLogin
  responseElements.ConsoleLogin:"Failure"
  | groupbycount(
  userIdentity.arn
  )
  | where @q.count >= 4
time_range_s: 900
run_frequency_s: 300
event_sink_keys:
- medium_severity_alerts
tags:
- source.aws
- domain.identity
- domain.authentication
- tactics.ta0006.credential_access
- tactics.ta0001.initial_access
- techniques.t1110.brute_force
- techniques.t1078.valid_accounts
context_fields:
- eventTime
- awsRegion
- recipientAccountId
- eventSource
- eventName
- userIdentity.type
- userIdentity.arn
- userIdentity.accountId
- sourceIPAddress
- userAgent
- responseElements.ConsoleLogin
- errorMessage
- additionalEventData
