# schema: https://scanner.dev/schema/scanner-detection-rule.v1.json
name: AWS SES Service Modification
enabled: true
severity: Medium
description: |-
  ## Goal
  Detect when the Amazon Simple Email Service (SES) has been modified in ways that could allow an attacker to propagate phishing email campaigns. This includes actions like creating, deleting, and verifying identities, as well as enabling or configuring SES sending.

  ## Strategy
  Monitor AWS CloudTrail management events from `ses.amazonaws.com` for the following API calls:
  * `CreateEmailIdentity`
  * `DeleteEmailIdentity`
  * `VerifyEmailIdentity`
  * `VerifyDomainIdentity`
  * `VerifyDomainDkim`
  * `UpdateAccountSendingEnabled`
  * `UpdateConfigurationSetSendingEnabled`
  * `PutAccountSendingAttributes`
  * `PutConfigurationSetSendingOptions`

  ## Triage and Response
  * Confirm whether the SES configuration change was part of an approved change request.
  * Identify which identities, domains, or configuration sets were created, deleted, or modified.
  * If unapproved, disable or roll back the change (for example, disable sending or remove the new identity) and rotate any related credentials.
  * Review other recent changes and activity by the same principal for additional signs of abuse or phishing setup.
query_text: |-
  %ingest.source_type="aws:cloudtrail"
  eventSource:"ses.amazonaws.com"
  eventName:(
  CreateEmailIdentity
  DeleteEmailIdentity
  VerifyEmailIdentity
  VerifyDomainIdentity
  VerifyDomainDkim
  UpdateAccountSendingEnabled
  UpdateConfigurationSetSendingEnabled
  PutAccountSendingAttributes
  PutConfigurationSetSendingOptions
  )
  not errorCode:*
  | groupbycount(
  recipientAccountId,
  userIdentity.arn,
  awsRegion
  )
  | where @q.count > 0
time_range_s: 3600
run_frequency_s: 3600
event_sink_keys:
- medium_severity_alerts
tags:
- source.aws
- domain.cloud
- domain.email
- domain.ses
- tactics.ta0040.impact
- techniques.t1496.resource_hijacking
- use_case.aws_ses
- use_case.phishing_infrastructure
context_fields:
- recipientAccountId
- awsRegion
- eventSource
- eventName
- eventTime
- sourceIPAddress
- userAgent
- userIdentity.type
- userIdentity.arn
- userIdentity.accountId
- requestParameters
- additionalEventData
