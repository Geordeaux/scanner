# schema: https://scanner.dev/schema/scanner-detection-rule.v1.json
name: AWS Config Service Modified
enabled: true
severity: High
description: |-
  ## Goal
  Detect when AWS Config recorders or delivery channels are stopped, deleted, or modified. These actions may indicate an attempt to disable or impair configuration auditing and security monitoring.

  ## Strategy
  Monitor AWS CloudTrail management events from `config.amazonaws.com` for:
  * `StopConfigurationRecorder`
  * `DeleteConfigurationRecorder`
  * `DeleteDeliveryChannel`
  * `PutDeliveryChannel`
  * `PutConfigurationRecorder`

  These changes may be:
  * Legitimate configuration maintenance, or
  * Malicious attempts to tamper with AWS Config so that future changes are no longer recorded or delivered.

  ## Triage and Response
  * Confirm whether the change aligns with an approved change request or maintenance window.
  * Validate that the initiating principal is authorised to administer AWS Config at the account and/or organisation level.
  * Review the before/after state of the recorder and delivery channel (status, included resources, global resources, SNS/S3 destinations, encryption configuration).
  * Investigate other recent activity from the same principal and source IP for signs of broader compromise.
  * If unauthorised or suspicious, treat as a high-severity incident: restore known-good AWS Config settings, constrain affected credentials, and perform a wider compromise assessment.
query_text: |-
  %ingest.source_type="aws:cloudtrail"
  eventSource="config.amazonaws.com"
  eventName:(
  "StopConfigurationRecorder"
  "DeleteConfigurationRecorder"
  "DeleteDeliveryChannel"
  "PutDeliveryChannel"
  "PutConfigurationRecorder"
  )
  | groupbycount(
  recipientAccountId,
  requestParameters.configurationRecorder.name,
  userIdentity.arn,
  awsRegion
  )
  | where @q.count > 0
time_range_s: 3600
run_frequency_s: 300
event_sink_keys:
- high_severity_alerts
tags:
- source.aws
- domain.cloud
- domain.config
- domain.logging
- tactics.ta0005.defence_evasion
- techniques.t1562.008.impair_defences_disable_cloud_logs
- use_case.aws_config
- use_case.logging_integrity
context_fields:
- recipientAccountId
- userIdentity.type
- userIdentity.arn
- userIdentity.accountId
- userIdentity.sessionContext.sessionIssuer.arn
- awsRegion
- eventSource
- eventName
- eventTime
- sourceIPAddress
- userAgent
- requestParameters
- responseElements
- additionalEventData
