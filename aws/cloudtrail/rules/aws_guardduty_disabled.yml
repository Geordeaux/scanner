# schema: https://scanner.dev/schema/scanner-detection-rule.v1.json
name: AWS GuardDuty Disabled
enabled: true
severity: High
description: |-
  ## Goal
  Detects when an Amazon GuardDuty detector is disabled or deleted. This may indicate an attempt to impair defences by turning off threat detection and monitoring.

  ## Strategy
  Monitor AWS CloudTrail management events from `guardduty.amazonaws.com` and alert on:
  * `DeleteDetector` events, or
  * `UpdateDetector` events where the detector is explicitly disabled (for example, `enable=false` in the request parameters).

  These actions should be rare, tightly controlled, and usually associated with planned maintenance or onboarding/offsboarding workflows. Any unplanned change warrants investigation.

  ## Triage and Response
  * Identify who initiated the change (IAM user or role), from where (IP, user agent), and in which account and region.
  * Confirm there is an approved change, maintenance window, or documented migration that explains disabling or deleting GuardDuty.
  * If there is no valid justification:
    * Treat as a high-severity incident (potential defence evasion).
    * Immediately re-enable GuardDuty (or recreate the detector) where appropriate.
    * Review other recent CloudTrail activity for the same principal and account (especially around IAM, CloudTrail, Config, logging, and network controls).
    * Escalate according to the incident response process.
query_text: |-
  %ingest.source_type="aws:cloudtrail"
  eventSource:"guardduty.amazonaws.com"
  (
  eventName:"DeleteDetector" or
  (
  eventName:"UpdateDetector" and
  requestParameters.enable:false
  )
  )
  | where errorCode IS NULL
time_range_s: 3600
run_frequency_s: 3600
event_sink_keys:
- high_severity_alerts
tags:
- source.aws
- domain.cloud
- domain.guardduty
- domain.logging_and_monitoring
- tactics.ta0005.defence_evasion
- techniques.t1562.impair_defences
- techniques.t1562.008.disable_cloud_logging_monitoring
- use_case.control_plane_hardening
context_fields:
- userIdentity.type
- userIdentity.arn
- userIdentity.userName
- sourceIPAddress
- userAgent
- awsRegion
- requestParameters
- responseElements
- recipientAccountId
- eventID
- eventTime
