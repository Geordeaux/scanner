# schema: https://scanner.dev/schema/scanner-detection-rule.v1.json
name: AWS CloudTrail Logging Tampered
enabled: true
severity: High
description: |-
  ## Goal
  Detect when AWS CloudTrail logging is updated, stopped, deleted, or when event selectors are modified. These actions can indicate attempts to disable or impair logging of security-relevant events.

  ## Strategy
  Monitor AWS CloudTrail management events from `cloudtrail.amazonaws.com` for:
  * `UpdateTrail`
  * `StopLogging`
  * `DeleteTrail`
  * `PutEventSelectors`

  These changes may be:
  * Legitimate administrative maintenance of logging configuration, or
  * Malicious attempts to inhibit detection by disabling, limiting, or redirecting CloudTrail logging.

  ## Triage and Response
  * Confirm whether the change aligns with an approved change request or maintenance window.
  * Validate that the initiating principal is authorised to modify CloudTrail trails and organisation-level logging.
  * Review the before/after configuration (trail status, destinations, event selectors, encryption, multi-region and organisation-trail flags).
  * Investigate other recent activity by the same principal and from the same source IP for signs of broader compromise.
  * If unauthorised or suspicious, treat as a high-severity incident: restore known-good CloudTrail configuration, lock down relevant credentials, and perform wider compromise assessment.
query_text: |-
  %ingest.source_type="aws:cloudtrail"
  eventSource="cloudtrail.amazonaws.com"
  eventName:(
  "UpdateTrail"
  "StopLogging"
  "DeleteTrail"
  "PutEventSelectors"
  )
  | groupbycount(
  recipientAccountId,
  requestParameters.name,
  userIdentity.arn,
  awsRegion
  )
  | where @q.count > 0
time_range_s: 3600
run_frequency_s: 300
event_sink_keys:
- high_severity_alerts
tags:
- source.aws
- domain.cloud
- domain.logging
- domain.cloudtrail
- tactics.ta0005.defence_evasion
- techniques.t1562.008.impair_defences_disable_cloud_logs
- use_case.aws_cloudtrail
- use_case.logging_integrity
context_fields:
- recipientAccountId
- userIdentity.type
- userIdentity.arn
- userIdentity.accountId
- userIdentity.sessionContext.sessionIssuer.arn
- awsRegion
- eventSource
- eventName
- eventTime
- sourceIPAddress
- userAgent
- requestParameters
- responseElements
- additionalEventData
