# schema: https://scanner.dev/schema/scanner-detection-rule.v1.json
name: AWS High Number Of Unknown User Authentication Attempts
enabled: true
severity: Low
description: |-
  ## Goal
  Detects when a high number of failed authentication attempts occur for unknown users. This may indicate credential stuffing or brute force activity against the AWS Console.

  ## Strategy
  Monitor AWS CloudTrail `ConsoleLogin` events from `signin.amazonaws.com` where:
  * The login result is `Failure`, and
  * The `errorMessage` is `No username found in supplied account`.

  Aggregate failures by `sourceIPAddress` over a 10-minute window and alert when the number of such failures from a single IP address exceeds a defined threshold (for example, 10 events in 10 minutes).

  ## Triage and Response
  * Identify the source IP, user agent, and target AWS account.
  * Check whether the source IP is associated with:
    * Corporate egress, VPN endpoints, or known partners; or
    * Suspicious or unknown infrastructure (cloud provider hosts, TOR, hosting, residential ranges in unexpected geographies).
  * Review whether this behaviour overlaps with any other authentication anomalies (valid logins, MFA prompts, password reset attempts).
  * If activity is not clearly attributable to a legitimate test or known misconfiguration:
    * Treat as credential-stuffing / brute-force activity.
    * Consider blocking or challenging the IP or IP range at the identity provider, WAF, or network edge.
    * Review identity provider and application logs for any successful logins correlated with the same IP, user agent, or time window.
    * Coordinate with incident response for wider investigation if attempts appear targeted or persistent.
query_text: |-
  %ingest.source_type="aws:cloudtrail"
  eventSource:"signin.amazonaws.com"
  eventName:"ConsoleLogin"
  responseElements.ConsoleLogin:"Failure"
  errorMessage:"No username found in supplied account"
  | groupbycount(
  sourceIPAddress,
  recipientAccountId
  )
  | where @q.count >= 10
time_range_s: 600
run_frequency_s: 600
event_sink_keys:
- low_severity_alerts
tags:
- source.aws
- domain.cloud
- domain.identity_and_access
- tactics.ta0006.credential_access
- techniques.t1110.brute_force
- use_case.auth_bruteforce
- use_case.cloud_console_authentication
context_fields:
- userIdentity.type
- userIdentity.arn
- userIdentity.userName
- sourceIPAddress
- userAgent
- awsRegion
- errorMessage
- recipientAccountId
- eventID
- eventTime
