# schema: https://scanner.dev/schema/scanner-detection-rule.v1.json
name: AWS IAM Activity By S3 Browser Utility
enabled: true
severity: High
description: |-
  ## Goal
  Detects AWS IAM activities associated with the S3 Browser utility. This may indicate an attempt to manipulate IAM accounts using unauthorised or suspicious tools.

  ## Strategy
  Monitor AWS CloudTrail management events where:
  * The service is IAM (`iam.amazonaws.com`), and
  * The action is one of:
    * `CreateUser`
    * `CreateLoginProfile`
    * `CreateAccessKey`
    * `PutUserPolicy`
  * The `userAgent` contains the S3 Browser client identifier (for example, `S3 Browser`).

  A single matching event is sufficient to generate an alert, as IAM account creation and policy changes via third-party tools are high-impact.

  ## Triage and Response
  * Identify the calling principal (IAM user or assumed role), source IP, and the exact IAM changes performed.
  * Confirm with the relevant team whether S3 Browser is:
    * An approved tool in your environment, and
    * Expected for this principal and host.
  * If use of S3 Browser is not explicitly approved:
    * Treat the activity as potentially malicious.
    * Review recent authentication activity for the principal (logins, key usage, geolocation, device).
    * Examine additional IAM changes around the same time (new keys, new users, inline policies, policy attachments).
    * Consider revoking or rotating any access keys created, and tightening or temporarily disabling the affected principal.
  * If confirmed legitimate, consider:
    * Migrating workflows to more controlled tooling (AWS Console/CLI with audited configuration).
    * Adding explicit allow-listed principals or user agents if you decide to tolerate this pattern with reduced noise.
query_text: |-
  %ingest.source_type="aws:cloudtrail"
  eventSource:"iam.amazonaws.com"
  eventName:(
  "CreateUser"
  "CreateLoginProfile"
  "CreateAccessKey"
  "PutUserPolicy"
  )
  userAgent:/S3 Browser/
time_range_s: 3600
run_frequency_s: 3600
event_sink_keys:
- high_severity_alerts
tags:
- source.aws
- domain.cloud
- domain.identity_and_access
- domain.iam
- tactics.ta0003.persistence
- techniques.t1098.account_manipulation
- use_case.third_party_client
- use_case.iam_anomaly
context_fields:
- userIdentity.type
- userIdentity.arn
- userIdentity.userName
- sourceIPAddress
- userAgent
- awsRegion
- eventTime
- eventID
- recipientAccountId
- requestParameters
