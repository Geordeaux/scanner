# schema: https://scanner.dev/schema/scanner-threat-hunting-query.v1.json
name: AWS MultiFactor Authentication Disabled
description: |-
  Detects attempts to disable multi-factor authentication (MFA) for an AWS IAM user, which could indicate an unauthorized attempt to bypass MFA.
query_text: |-
  %ingest.source_type="aws:cloudtrail"
  metadata.vendor_name:AMAZON
  metadata.product_name:"AWS CloudTrail"
  (
  metadata.product_event_type:DeleteVirtualMFADevice or
  metadata.product_event_type:DeactivateMFADevice
  )
  security_result.action:ALLOW
  | groupbycount(
  additional.fields.recipientAccountId,
  principal.user.user_display_name
  )
  | where @q.count > 0
tags:
- source.aws
- domain.cloud
- domain.iam
- credential_access
- defense_evasion
- persistence
- modify_authentication_process
- multi_factor_authentication
- techniques.t1556.modify_authentication_process
- tactics.ta0006.credential_access
- tactics.ta0005.defense_evasion
- tactics.ta0003.persistence
