# schema: https://scanner.dev/schema/scanner-threat-hunting-query.v1.json
name: AWS IAM Activity From EC2 Instance
description: |-
  Detects AWS IAM activities performed by AWS EC2 instances, which can indicate an attempt to retain access or escalate privileges. This is a high-severity concern as it may indicate unauthorised actions being taken from EC2 instances.
query_text: |-
  %ingest.source_type="aws:cloudtrail"
  eventSource:"iam.amazonaws.com"
  eventName:(
  "CreateUser"
  "AttachUserPolicy"
  "CreateLoginProfile"
  "UpdateLoginProfile"
  "CreateAccessKey"
  "CreateGroup"
  "AttachGroupPolicy"
  "CreateRole"
  "AttachRolePolicy"
  )
  userIdentity.type:"AssumedRole"
  userIdentity.arn:/assumed-role\/.*\/i-[0-9a-f]+/
tags:
- source.aws
- domain.cloud
- domain.identity_and_access
- domain.iam
- tactics.ta0003.persistence
- techniques.t1098.account_manipulation
- use_case.ec2_iam_activity
- use_case.iam_anomaly
