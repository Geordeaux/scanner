# schema: https://scanner.dev/schema/scanner-threat-hunting-query.v1.json
name: AWS Privilege Escalation Using IAM Access Key
description: |-
  Detect when a user creates a new IAM access key for another IAM user, which can be used for privilege escalation by unauthorized users.
query_text: |-
  %ingest.source_type="aws:cloudtrail"
  metadata.vendor_name:AMAZON
  metadata.product_name:"AWS CloudTrail"
  metadata.product_event_type:"CreateAccessKey"
  security_result.action:"ALLOW"
  target.user.userid:*
  | groupbycount(
  principal.user.user_display_name,
  target.user.userid,
  principal.ip
  )
  | where @q.count > 0
tags:
- source.aws
- domain.iam
- domain.cloud
- tactics.ta0003.persistence
- techniques.t1136.account_creation
- use_case.iam_privilege_escalation
