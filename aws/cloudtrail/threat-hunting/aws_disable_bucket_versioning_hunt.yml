# schema: https://scanner.dev/schema/scanner-threat-hunting-query.v1.json
name: AWS S3 Bucket Versioning Disable
description: |-
  Detects when S3 bucket versioning is disabled. Threat actors use this technique during AWS ransomware incidents prior to deleting S3 objects.

  References:
  * https://invictus-ir.medium.com/ransomware-in-the-cloud-7f14805bbe82

  False Positives:
  * AWS administrator legitimately disabling bucket versioning
query_text: |-
  %ingest.source_type="aws:cloudtrail"
  eventSource="s3.amazonaws.com"
  eventName="PutBucketVersioning"
  requestParameters.VersioningConfiguration.Status: 'suspended'
  | stats
  min(@scnr.datetime) as firstTime,
  max(@scnr.datetime) as lastTime,
  count() as eventCount
  by
  userIdentity.arn,
  eventSource,
  eventName,
  awsRegion
tags:
- tactics.ta0040.impact
- techniques.t1485.data_destruction
- source.cloudtrail
