# schema: https://scanner.dev/schema/scanner-threat-hunting-query.v1.json
name: EC2 Suspicious Get User Password Request
description: |-
  Identifies when a user makes `GetPasswordData` requests for multiple different EC2 instances.
  This API call retrieves the encrypted administrator password for an instance running Windows. Multiple requests may indicate an adversary attempting to escalate privileges or move laterally.
query_text: |-
  %ingest.source_type:aws:cloudtrail
  eventName:GetPasswordData
  eventSource:"ec2.amazonaws.com"
  | parse_json requestParameters "instanceId"
  | stats count_distinct(instanceId) as instance_count by userIdentity.arn
  | where instance_count >= 2
tags:
- tactics.ta0006.credential_access
- techniques.t1552.005.cloud_instance_metadata_api
- source.aws.cloudtrail
