# schema: https://scanner.dev/schema/scanner-threat-hunting-query.v1.json
name: AWS EC2 High Number Of API Calls
description: |-
  Detects when an EC2 instance makes a high number of API calls within a short period. This can indicate reconnaissance activity, aggressive automation, or misconfigured tooling.
query_text: |-
  %ingest.source_type="aws:cloudtrail"
  userIdentity.type:"AssumedRole"
  userIdentity.principalId:*i-*
  (not errorCode:*)
  | groupbycount(userIdentity.principalId, sourceIPAddress)
  | where @q.count > 50
tags:
- source.aws
- domain.cloud
- domain.aws_ec2
- tactics.ta0007.discovery
- techniques.t1580.cloud_infrastructure_discovery
- use_case.ec2_reconnaissance
- use_case.anomalous_api_activity
